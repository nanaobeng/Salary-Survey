
    {% extends "new_admin_layout.html" %}


   
    
    {% block content %}
    <style>
            #hero {
  width: 100%;
  height: 15vh;
  background: url("../static/img/home.jpg") top center;
  background-size: cover;
  position: relative;
  }
  
  #hero:before {
  content: "";
  background: rgba(20, 44, 9, 0.7);
  position: absolute;
  bottom: 0;
  top: 0;
  left: 0;
  right: 0;
  }
  
  #hero .container {
  text-align: center;
  padding-top: 50px;
  }
  
  @media (max-width: 992px) {
  #hero .container {
    padding-top: 0;
  }
  }
  
  #hero h1 {
  margin: 0;
  font-size: 48px;
  font-weight: 700;
  line-height: 56px;
  color: #fff;
  }
  
  #hero h2 {
  color: #eee;
  margin: 15px 0 0 0;
  font-size: 22px;
  }
  
  #hero .btn-get-started {
  font-family: "Raleway", sans-serif;
  font-weight: 500;
  font-size: 15px;
  letter-spacing: 1px;
  display: inline-block;
  padding: 9px 35px;
  border-radius: 50px;
  transition: 0.5s;
  margin-top: 40px;
  border: 2px solid #ffc107;
  color: #fff;
  }
  
  #hero .btn-get-started:hover {
  background: #ffc107;
  }
  
  @media (min-width: 1024px) {
  #hero {
    background-attachment: fixed;
  }
  }
  
  @media (max-width: 768px) {
  #hero {
    height: 100vh;
  }
  #hero h1 {
    font-size: 28px;
    line-height: 36px;
  }
  #hero h2 {
    font-size: 18px;
    line-height: 24px;
  }
  }
 

  .card {
    padding: 20px;
  }

  a {
    color: inherit;
  }
  
  #searchbar {
    margin-bottom: auto;
    margin-top: auto;
    height: 60px;
  }

  #search_input {
    border-radius: 10px;
    outline: 0;
    width: 450px;
    line-height: 30px;
    padding: 0 10px;
  }

  #search_icon {
    color: white;
    margin-left: 5px;
  }

  .dropdowndown-menu {
    padding: 10px;
  }

  #filterbutton {
    color: white;
  }

  .addBtn {
  padding: 10px;
  width: 25%;
  background: #d9d9d9;
  color: #555;
  float: left;
  text-align: center;
  font-size: 16px;
  cursor: pointer;
  transition: 0.3s;
  border-radius: 0;
}

.addBtn:hover {
  background-color: #bbb;
}
</style>


<!--Header-->
<div class="row">
  <div class="col-12">
    <section id="hero" class="d-flex align-items-center justify-content-center">
      <div class="container position-relative">
        <h2><b style="font-size: 30px;">Service Requests</b></h2>

      </div>
    </section>
  </div>
</div>


<!--Body-->

<div class="row p-5 justify-content-center">
  <div class="col-8">
    <table class="table table-hover">
      <thead style="background-color: rgb(78, 110, 62);">
        <th id="searchbar">
          <input type="text" id="search_input" onkeyup="myFunction()" placeholder="Search...">
          
          <a href="#"><i class="fas fa-search" id="search_icon"></i></a>
        </th>
        <th>
          <button id="filterbutton" class="btn dropdown-toggle" type="button" data-toggle="dropdown">Filter <i
              class="icofont-settings"></i></span></button>
          <form class="dropdown-menu p-2">
            <div class="form-group">
              <label for="status">Status:</label>
              <select class="form-control" id="status" onchange="filter('status')">
                <option value="opened">Pending</option>
          <option value="close">Awaiting Client Information</option>
          <option>First Pass</option>
          <option>Conflict Check</option>
          <option>Finish Completion</option>
          <option>Submitted For Approval</option>
              </select>
            </div>
          </form>
        </th>
      </thead>
    </table>
  </div>
</div>




<div class="py-5">
  <div class="container">
    <div class="row hidden-md-up">
      <h4 style="text-align:left"><i>Individual Requests</i> </h4>
      {% if ind %}
      {% for i in ind %}
        
        <div class="col-md-3">
          <div class="card border-primary mb-4 bg-light">
          
            <div class="card-body" onclick="viewRequests('{{i.id}}')" data-id="{{i.id}}" data-toggle="modal" href="#viewRequestModal">
              <a class="stretched-link"  >
                
                <h4 class="card-title">
                  {{i.firstname}} {{other}} {{i.lastname}}
              </h4>
              </a>
              <p class="card-subtitle text-muted">{{i.email}}</p>
              <p class="card-text p-y-1">{{i.service}}.</p>
              <span class="badge badge-success">{{i.status}}</span>
            </div>
          </div>
        </div>
      {% endfor %}
      {% else %}
      <p class="col-row"style="text-align:center;">
        
          <em> You have no pending requests to view.</em>
       
      </p>
      {% endif %}
    </div>


    <div class="row hidden-md-up">
      <h4 style="text-align:left"><i>Corporate Requests</i> </h4>
      {% if corp %}
      {% for i in corp %}
        
        <div class="col-md-3">
          <div class="card" onclick="viewRequests('{{i.id}}', this)" data-id="{{i.id}}">
            <!-- <img class="card-img-top"
              src="https://assets.weforum.org/article/image/h8zzPl7mwOEfDPhQGyspAOz2uIHhOZMQcW-pzm2Lc-A.jpg"
              alt="Card image" style="width:100%"> -->
            <div class="card-body">
              <a class="stretched-link" data-toggle="modal" href="#viewRequestModal">
                
                <h4 class="card-title">
                  {{i.company_name}}
              </h4>
              </a>
              <h6 class="card-subtitle text-muted">{{i.company_email}} {{i.id}}</h6>
              <p class="card-text p-y-1">{{i.service}}</p>
              <span id='status' class="badge badge-success">{{i.status}}</span>
            </div>
            <script>
              var s = document.getElementById("status").innerHTML;
              document.write(s);
           </script>
          </div>
        </div>
      {% endfor %}
      {% else %}
      <p class="col-row"style="text-align:center;">
        
          <em> You have no pending requests to view.</em>
       
      </p>
      {% endif %}
    </div>
  </div>
</div>


<!-- Individual Request Modal -->

<div class="modal fade" id="viewRequestModal" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <form action="" method="POST" id="updateForm" onsubmit="updateRequest()">
      <div id="head" class="modal-header d-block" style="height: auto">    
      </div>
      <div id="body" class="modal-body">
        <!--Request Description-->
        
      </div>
    
   <div class="modal-footer form-group">
     {{ form.submit(class="btn btn-success btn-max") }}
   </div>
     
  </form>
    </div>
    </div>
  </div>
<!--End of modal content-->

    </div>

  </div>

<!--End of modal-->

<!-- Corporate Request Modal -->

<div class="modal fade" id="viewCorporateRequestModal" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="container" style="height: auto">
        <form method="POST" action="./service_requests" id="updateForm" onsubmit="updateRequest()"  style="display: inline">
            <br/>
           
            <fieldset class="form-group">
      <div class="modal-header d-block">
        
      </div>
      <div class="modal-body">
        <!--Request Description-->
        
        <hr>
   
      </div>
    </fieldset>
   <div class="modal-footer form-group">
      
      <!-- <button type="button" class="btn btn-primary">Save changes</button>-->
     {{ form.submit(class="btn btn-success btn-max") }}
   
   </div>
     
    
    </form>
    </div>
  </div>
<!--End of modal content-->

    </div>

  </div>

<!--End of modal-->

<script>
  function viewRequests(modal, element){
    localStorage.setItem('requestId', $(element).attr('data-id'))
    $.ajax({
      url: '/view_request',
      data: { 
        id: modal
      },
      type: 'POST',
      success: function(res){
        console.log(res)
        res1 = res[0]
       
        $('#head').html(
          `<div class="d-flex">
          <h4 class="modal-title"> ${res1.firstname} ${res1.lastname}</h3>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <h6 style="color: gray;" class="modal-title">${res1.email}</h5>`
        )
        $('#body').html(
          `<div>
          <p>Request Title: <span style="color: gray;">${res1.service}</span></p>
          <p>Address: <span style="color: gray;">${res1.address},  ${res1.city}, ${res1.country}.
            </span></p>
        </div>
        <hr>
        <!--Change Status / Add Comments-->
        <div class="form-group">
            <p>Comments:
            <ol id="commentList" style="color: gray;">
              
            </ol>
            </p>
          {{form.comment.label(class="comment-label")}}
            {% if form.comment.errors %}
              {{ form.comment(class="form-control form-control is-invalid")}}
              <div class="invalid-feedback">
                  {% for error in form.comment.errors %}
                  <span> {{ error}}</span>
                  {% endfor %}
              </div>
              {% else %}
              {{ form.comment(class="form-control form-control") }}
              {% endif %}
  
          <button class="btn btn-outline-danger btn-sm" type="reset">Clear Comment</button>
          {{form.submit}}

        </div>
        <hr>
        <!--Change Status-->
        <div class="row">
          
       <div class="form-group">
          
          {{ form.newstatus.label(class="form-control-label") }}
  
                  {% if form.newstatus.errors %}
                  {{ form.newstatus(class="form-control form-control is-invalid")}}
                  <div class="invalid-feedback">
                      {% for error in form.status.errors %}
                      <span> {{ error}}</span>
                      {% endfor %}
                  </div>
                  {% else %}
                  {{ form.newstatus(class=" form-control") }}
                  {% endif %}
             
          </div>
          <div class="col-3 float-right">
            <i class="far fa-envelope" style="margin-right: 5px;"></i><a
              href="mailto:${res1.email}?subject=Thank You For Reaching Out To Us" style="color: inherit;">Send
              Email</a>
          </div>
        </div>
      `
        )
        for (var i=0; i<res[1].comments.length; i++){
          $('#commentList').append('<li>' + res[1].comments[i] + '</li>')
        }
      },
      error: function(error){
        console.log(error)
      }
    })
  }

  function updateRequest(){
    var requestId = localStorage.getItem('requestId')
    document.getElementById('updateForm').action = 'service_requests/update/' + requestId
  }
</script>



<script>
  function filter(view) {
    if (view == 'status') {

      var unique = ($('#status').val()).trim().replace(/\s/g, '')

      if ($("#" + unique).length == 0) {
        $('.filter_box').prepend('<div id="' + unique + '"class="col-1"><span class="badge badge-pill badge-info">' + $('#status').val() + ' <span><i class="icofont-close-line-circled" onclick="remove_filter(' + unique + ')"></i></span></span></div>')
      }
    }

    if (view == 'client') {

      var unique = ($('#client').val()).trim().replace(/\s/g, '')

      if ($("#" + unique).length == 0) {
        $('.filter_box').prepend('<div id="' + unique + '"class="col-1"><span class="badge badge-pill badge-warning">' + $('#client').val() + ' <span><i class="icofont-close-line-circled" onclick="remove_filter(' + unique + ')"></i></span></span></div>')
      }
    }


    if (view == 'industry') {

      var unique = ($('#industry').val()).trim().replace(/\s/g, '')

      if ($("#" + unique).length == 0) {
        $('.filter_box').prepend('<div id="' + unique + '"class="col-1"><span class="badge badge-pill badge-danger">' + $('#industry').val() + ' <span><i class="icofont-close-line-circled" onclick="remove_filter(' + unique + ')"></i></span></span></div>')
      }
    }

    if (view == 's_period') {

      var unique = ($('#s_period').val())
      unique = unique.replace(/[&\/\\#,+()$~%.'":*?<>{}]/g, '')
      unique = "a" + unique

      if ($("#" + unique).length == 0) {
        $('.filter_box').prepend('<div id="' + unique + '"class="col-1"><span class="badge badge-pill badge-success">' + $('#s_period').val() + ' <span><i class="icofont-close-line-circled" onclick="remove_filter(' + unique + ')"></i></span></span></div>')
      }
    }
  }
</script>

<script>
  function remove_filter(id) {

    $(id).remove()
  }
</script>

<script>
  function clear_filter() {
    $('.filter_box').empty()
  }
</script>


<script>

  
  // Create a new list item when clicking on the "Add" button
  function newElement() {
    var li = document.createElement("li");
    var inputValue = document.getElementById("myInput").value;
    var t = document.createTextNode(inputValue);
    li.appendChild(t);
    if (inputValue === '') {
      alert("You must write something!");
    } else {
      document.getElementById("myUL").appendChild(li);
    }
    document.getElementById("myInput").value = "";
  
    var span = document.createElement("SPAN");
    var txt = document.createTextNode("\u00D7");
    span.className = "close";
    span.appendChild(txt);
    li.appendChild(span);
  
    for (i = 0; i < close.length; i++) {
      close[i].onclick = function() {
        var div = this.parentElement;
        div.style.display = "none";
      }
    }
  }
  </script>
  
{% endblock content %}